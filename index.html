<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Stobix 24h Scannier</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin: 0; font-family: system-ui; background: #05060a; color: #e5e7eb; min-height: 100vh; padding: 20px; }
    .container { max-width: 1200px; margin: auto; }
    .header { margin-bottom: 20px; }
    h1 { margin: 0 0 5px 0; font-size: 24px; }
    .status { font-size: 12px; color: #9ca3af; margin: 10px 0; }
    .controls { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
    .control { display: flex; flex-direction: column; gap: 5px; }
    .control label { font-size: 11px; text-transform: uppercase; color: #9ca3af; }
    .control input, .btn { background: #0b0d14; border: 1px solid #1f2933; color: #e5e7eb; padding: 8px 12px; border-radius: 6px; font-size: 13px; cursor: pointer; }
    .btn { background: #1d4ed8; border-color: #3b82f6; }
    .main { display: grid; grid-template-columns: 1.4fr 1fr; gap: 15px; }
    .panel { background: #0b0d14; border: 1px solid #1f2933; border-radius: 12px; padding: 15px; }
    .panel-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; text-transform: uppercase; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th { background: #0f172a; padding: 8px; text-align: left; font-weight: 500; color: #9ca3af; border-bottom: 1px solid #1f2933; }
    td { padding: 8px; border-bottom: 1px solid #1f2933; }
    tr:hover { background: #1f2933; }
    .green { color: #22c55e; }
    .red { color: #ef4444; }
    .summary { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    .summary-item { flex: 1; min-width: 120px; background: #05060a; border: 1px solid #1f2933; padding: 10px; border-radius: 8px; font-size: 11px; }
    .summary-label { color: #9ca3af; text-transform: uppercase; margin-bottom: 5px; }
    .summary-value { font-size: 14px; font-weight: 500; }
    @media (max-width: 900px) { .main { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Stobix Futures 24h Scanner</h1>
      <div class="status">
        <span class="green">●</span> <span id="status">Загрузка данных...</span>
      </div>
      <div class="controls">
        <div class="control">
          <label for="topN">Топ N</label>
          <input id="topN" type="number" min="1" max="100" value="10" />
        </div>
        <div class="control">
          <label for="minVol">Мин. объём 24h (M USDT)</label>
          <input id="minVol" type="number" min="0" value="1" />
        </div>
        <div class="control" style="justify-content: flex-end;">
          <button class="btn" onclick="location.reload()">⟳ Обновить</button>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="panel">
        <div class="panel-title">Лидеры (Gainers)</div>
        <table id="gainersTable">
          <thead><tr><th>Пара</th><th>Цена</th><th>% (24h)</th><th>Объём 24h</th></tr></thead>
          <tbody id="gainersBody"></tbody>
        </table>
      </div>

      <div class="panel">
        <div class="panel-title">Лузеры (Losers)</div>
        <table id="losersTable">
          <thead><tr><th>Пара</th><th>Цена</th><th>% (24h)</th><th>Объём 24h</th></tr></thead>
          <tbody id="losersBody"></tbody>
        </table>
        <div class="summary">
          <div class="summary-item"><div class="summary-label">Всего пар</div><div class="summary-value" id="totalPairs">0</div></div>
          <div class="summary-item"><div class="summary-label">Макс. рост</div><div class="summary-value green" id="maxGain">0%</div></div>
          <div class="summary-item"><div class="summary-label">Макс. падение</div><div class="summary-value red" id="maxLoss">0%</div></div>
          <div class="summary-item"><div class="summary-label">Средний %</div><div class="summary-value" id="avgChange">0%</div></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const stobixPairsUrl = 'https://raw.githubusercontent.com/bandit201390/goat/main/data/stobix-pairs.json';
    const binanceUrl = 'https://fapi.binance.com/fapi/v1/ticker/24hr';
    let stobixPairs = [];
    let allMarkets = [];

    async function loadData() {
      try {
        const [pairsRes, marketsRes] = await Promise.all([
          fetch(stobixPairsUrl),
          fetch(binanceUrl)
        ]);
        const pairsData = await pairsRes.json();
        stobixPairs = pairsData.pairs.map(p => p.toUpperCase());
        
        const marketsData = await marketsRes.json();
        allMarkets = marketsData
          .filter(m => m.symbol.endsWith('USDT') && stobixPairs.includes(m.symbol.replace('USDT', '')))
          .map(m => ({
            symbol: m.symbol,
            price: parseFloat(m.lastPrice),
            volume: parseFloat(m.quoteVolume),
            change24h: parseFloat(m.priceChangePercent)
          }));
        
        document.getElementById('status').textContent = `Обновлено: ${new Date().toLocaleTimeString()}`;
        updateTables();
      } catch (err) {
        document.getElementById('status').textContent = 'Ошибка загрузки: ' + err.message;
      }
    }

    function updateTables() {
      const topN = Math.max(1, Math.min(100, parseInt(document.getElementById('topN').value)));
      const minVol = (parseInt(document.getElementById('minVol').value) || 0) * 1_000_000;
      
      let filtered = allMarkets.filter(m => m.volume >= minVol);
      document.getElementById('totalPairs').textContent = filtered.length;

      if (filtered.length === 0) {
        document.getElementById('gainersBody').innerHTML = '<tr><td colspan="4" style="text-align:center;">Нет данных</td></tr>';
        document.getElementById('losersBody').innerHTML = '<tr><td colspan="4" style="text-align:center;">Нет данных</td></tr>';
        return;
      }

      const gainers = filtered.sort((a, b) => b.change24h - a.change24h).slice(0, topN);
      const losers = filtered.sort((a, b) => a.change24h - b.change24h).slice(0, topN);

      function formatPrice(p) {
        if (p >= 1) return p.toFixed(4);
        if (p >= 0.01) return p.toFixed(6);
        return p.toFixed(8);
      }

      function formatVol(v) {
        if (v >= 1_000_000_000) return (v / 1_000_000_000).toFixed(1) + 'B';
        if (v >= 1_000_000) return (v / 1_000_000).toFixed(1) + 'M';
        return (v / 1_000).toFixed(0) + 'K';
      }

      document.getElementById('gainersBody').innerHTML = gainers.map(m => 
        `<tr><td>${m.symbol.replace('USDT', '')}</td><td>${formatPrice(m.price)}</td><td class="green">${m.change24h >= 0 ? '+' : ''}${m.change24h.toFixed(2)}%</td><td>${formatVol(m.volume)}</td></tr>`
      ).join('');

      document.getElementById('losersBody').innerHTML = losers.map(m => 
        `<tr><td>${m.symbol.replace('USDT', '')}</td><td>${formatPrice(m.price)}</td><td class="${m.change24h >= 0 ? 'green' : 'red'}">${m.change24h >= 0 ? '+' : ''}${m.change24h.toFixed(2)}%</td><td>${formatVol(m.volume)}</td></tr>`
      ).join('');

      const changes = filtered.map(m => m.change24h);
      document.getElementById('maxGain').textContent = (Math.max(...changes)).toFixed(2) + '%';
      document.getElementById('maxLoss').textContent = (Math.min(...changes)).toFixed(2) + '%';
      document.getElementById('avgChange').textContent = (changes.reduce((a, b) => a + b) / changes.length).toFixed(2) + '%';
    }

    document.getElementById('topN').addEventListener('input', updateTables);
    document.getElementById('minVol').addEventListener('input', updateTables);

    loadData();
  </script>
</body>
</html>
