<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Stobix 24h Gainers/Losers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    * {box-sizing: border-box}
    body {margin: 0; font-family: system-ui; background: #05060a; color: #e5e7eb; padding: 20px; min-height: 100vh}
    h1 {margin: 0 0 8px 0; font-size: 20px}
    .status {font-size: 11px; color: #9ca3af; margin: 5px 0}
    .controls {display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0; align-items: center}
    .ctrl {display: flex; flex-direction: column; gap: 4px}
    label {font-size: 10px; text-transform: uppercase; color: #9ca3af}
    input, .btn {background: #0b0d14; border: 1px solid #1f2933; color: #e5e7eb; padding: 6px 10px; border-radius: 4px; font-size: 12px}
    .btn {background: #1d4ed8; cursor: pointer}
    .timer {font-size: 11px; color: #9ca3af; min-width: 100px}
    .loading {opacity: 0.6}
    .main {display: grid; grid-template-columns: 1.4fr 1fr; gap: 15px; margin-top: 20px}
    table {width: 100%; font-size: 11px; margin-top: 10px; border-collapse: collapse; background: #0b0d14; border-radius: 6px; overflow: hidden}
    th {background: #0f172a; padding: 8px; text-align: left; border-bottom: 1px solid #1f2933; color: #9ca3af; font-weight: 500; font-size: 10px}
    td {padding: 8px; border-bottom: 1px solid #1f2933}
    tbody tr:hover {background: #1f2933}
    .green {color: #22c55e}
    .red {color: #ef4444}
    .panel {background: #0b0d14; border: 1px solid #1f2933; border-radius: 8px; padding: 12px}
    .title {font-size: 12px; font-weight: 600; text-transform: uppercase; margin-bottom: 10px}
    .summary {display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px}
    .item {flex: 1; min-width: 100px; background: #05060a; border: 1px solid #1f2933; padding: 8px; border-radius: 6px; font-size: 10px}
    .label {text-transform: uppercase; color: #9ca3af; margin-bottom: 4px}
    .value {font-size: 13px; font-weight: 500}
    .status-icon {font-weight: bold; font-size: 14px; min-width: 30px}
    .up {color: #22c55e}
    .down {color: #ef4444}
    .new {color: #fbbf24; font-weight: bold}
    @media(max-width: 900px) {.main {grid-template-columns: 1fr}}
  </style>
</head>
<body>
  <div style="max-width: 1200px; margin: auto">
    <h1>Stobix Futures 24h Scanner</h1>
    <div class="status"><span class="green" id="status-dot">‚óè</span> <span id="st">–û–±–Ω–æ–≤–ª–µ–Ω–æ</span></div>
    <div class="controls">
      <div class="ctrl"><label>–¢–æ–ø</label><input id="top" type="number" min="1" max="100" value="10"/></div>
      <button class="btn" onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å</button>
      <div class="timer"><span id="next-update">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑: 1h</span></div>
    </div>

    <div class="main">
      <div class="panel">
        <div class="title">–õ–∏–¥–µ—Ä—ã (Gainers)</div>
        <table><thead><tr><th>–ü–∞—Ä–∞</th><th>–¶–µ–Ω–∞</th><th>%24h</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody id="gainers"></tbody></table>
      </div>

      <div class="panel">
        <div class="title">–õ—É–∑–µ—Ä—ã (Losers)</div>
        <table><thead><tr><th>–ü–∞—Ä–∞</th><th>–¶–µ–Ω–∞</th><th>%24h</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody id="losers"></tbody></table>
        <div class="summary">
          <div class="item"><div class="label">–í—Å–µ–≥–æ</div><div class="value" id="total">0</div></div>
          <div class="item"><div class="label">–ú–∞–∫—Å+</div><div class="value green" id="maxg">0%</div></div>
          <div class="item"><div class="label">–ú–∞–∫—Å-</div><div class="value red" id="maxl">0%</div></div>
          <div class="item"><div class="label">–°—Ä–µ–¥–Ω</div><div class="value" id="avg">0%</div></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STOBIX_PAIRS = ["RENDER","STX","FET","WIF","CORE","BONK","PNUT","PEPE","PENGU","GALA","LPT","SHIB","IOTA","ALGO","HYPE","LINEA","XPL","STRK","RAY","TIA","BTC","ETH","SOL","BNB","XRP","SUI","DOGE","LTC","PUMP","ETHFI"];
    
    let data = [];
    let history = JSON.parse(localStorage.getItem('history')) || {};
    let lastUpdate = Date.now();

    async function fetchBinanceData() {
      try {
        document.getElementById('status-dot').textContent = '‚óã';
        document.getElementById('st').textContent = '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
        
        const symbols = STOBIX_PAIRS.map(p => p + 'USDT');
        const params = new URLSearchParams({symbols: JSON.stringify(symbols)});
        
        const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?${params}`);
        const tickers = await response.json();
        
        data = tickers
          .filter(t => STOBIX_PAIRS.includes(t.symbol.replace('USDT', '')))
          .map(t => ({
            s: t.symbol.replace('USDT', ''),
            p: parseFloat(t.lastPrice),
            c: parseFloat(t.priceChangePercent)
          }));
        
        lastUpdate = Date.now();
        document.getElementById('status-dot').textContent = '‚óè';
        document.getElementById('st').textContent = '–û–±–Ω–æ–≤–ª–µ–Ω–æ';
        render();
        updateTimer();
      } catch(e) {
        console.error('API error:', e);
        document.getElementById('st').textContent = '–û—à–∏–±–∫–∞ API';
      }
    }

    function getStatus(symbol, changePercent, type) {
      const key = type === 'gainers' ? 'g_' + symbol : 'l_' + symbol;
      const prev = history[key];
      let status = '';

      if (prev === undefined) {
        status = '<span class="status-icon new">üÜï</span>';
      } else if (changePercent > prev) {
        status = '<span class="status-icon up">‚ñ≤</span>';
      } else if (changePercent < prev) {
        status = '<span class="status-icon down">‚ñº</span>';
      } else {
        status = '<span class="status-icon">-</span>';
      }

      return status;
    }

    function render() {
      const top = Math.max(1, Math.min(100, parseInt(document.getElementById('top').value)));
      let f = data.slice();
      document.getElementById('total').textContent = f.length;

      if (!f.length) {
        document.getElementById('gainers').innerHTML = '<tr><td colspan=4>–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</td></tr>';
        document.getElementById('losers').innerHTML = '<tr><td colspan=4>–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</td></tr>';
        return;
      }

      const g = f.sort((a, b) => b.c - a.c).slice(0, top);
      const l = f.sort((a, b) => a.c - b.c).slice(0, top);

      const fmt = (p) => p >= 1 ? p.toFixed(4) : p >= 0.01 ? p.toFixed(6) : p.toFixed(8);

      document.getElementById('gainers').innerHTML = g.map(x => {
        const status = getStatus(x.s, x.c, 'gainers');
        return `<tr><td>${x.s}</td><td>$${fmt(x.p)}</td><td class="green">${x.c >= 0 ? '+' : ''}${x.c.toFixed(2)}%</td><td>${status}</td></tr>`;
      }).join('');

      document.getElementById('losers').innerHTML = l.map(x => {
        const status = getStatus(x.s, x.c, 'losers');
        const color = x.c >= 0 ? 'green' : 'red';
        return `<tr><td>${x.s}</td><td>$${fmt(x.p)}</td><td class="${color}">${x.c >= 0 ? '+' : ''}${x.c.toFixed(2)}%</td><td>${status}</td></tr>`;
      }).join('');

      const ch = f.map(x => x.c);
      document.getElementById('maxg').textContent = Math.max(...ch).toFixed(2) + '%';
      document.getElementById('maxl').textContent = Math.min(...ch).toFixed(2) + '%';
      document.getElementById('avg').textContent = (ch.reduce((a, b) => a + b) / ch.length).toFixed(2) + '%';

      let newHistory = {...history};
      g.forEach(x => newHistory['g_' + x.s] = x.c);
      l.forEach(x => newHistory['l_' + x.s] = x.c);
      localStorage.setItem('history', JSON.stringify(newHistory));
      history = newHistory;
    }

    function updateTimer() {
      const nextTime = lastUpdate + 3600000;
      setInterval(() => {
        const remaining = Math.max(0, nextTime - Date.now());
        const minutes = Math.floor(remaining / 60000);
        const seconds = Math.floor((remaining % 60000) / 1000);
        document.getElementById('next-update').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑: ${minutes}m ${seconds}s`;
        
        if (remaining === 0) fetchBinanceData();
      }, 1000);
    }

    document.getElementById('top').addEventListener('input', render);
    fetchBinanceData();
    setInterval(fetchBinanceData, 3600000);
  </script>
</body>
</html>
